# niNE
Это упрощенный 3D фреймворк для ролевых игр, вдохновленный SS14 и Garry's Mod. Он позволяет игрокам легко создавать серверы и расширять функциональность с помощью Python-плагинов с поддержкой дополнительных ресурсов.

![Версия Python](https://img.shields.io/badge/python-3.12+-blue.svg)
![Лицензия](https://img.shields.io/badge/license-MIT-green.svg)
![Panda3D](https://img.shields.io/badge/engine-Panda3D-orange.svg)

## Особенности

- **3D среда для ролевых игр**: Базовый 3D мир, в котором игроки могут подключаться и взаимодействовать
- **Простой хостинг серверов**: Запускайте серверы одним кликом или развертывайте отдельно
- **Расширенная система плагинов**: Поддержка плагинов как в виде файлов, так и папок с ресурсами
- **Сетевой мультиплеер**: Построен на asyncio и сокетах Python
- **Чат**: Внутриигровое текстовое общение

## Технологии

- **3D движок**: Panda3D
- **Сетевое взаимодействие**: asyncio с TCP сокетами
- **База данных**: Redis (для сохранения состояния игроков)
- **Сериализация**: JSON
- **Система плагинов**: Динамическая загрузка с поддержкой ресурсов

## Установка

### Предварительные требования

- Python 3.12 или выше
- `redis-server` (должен быть установлен и доступен в системном PATH для автоматического запуска)

```bash
pip install -r requirements.txt
```

### Быстрый старт

1. Клонируйте репозиторий:
```bash
git clone https://github.com/your-username/niNE.git
cd niNE
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Запустите сервер:
```bash
python server.py
```
Сервер попытается автоматически запустить собственный экземпляр Redis.

4. Запустите клиент:
```bash
python client.py
```

## Структура проекта

```
niNE/
├── requirements.txt        # Зависимости проекта
├── server.py               # Главная точка входа сервера
├── client.py               # Главная точка входа клиента
├── redis_data/             # Данные управляемого экземпляра Redis
├── nine/                   # Ядро фреймворка
│   ├── core/
│   │   ├── database.py     # Менеджер базы данных (Redis)
│   │   └── ...
│   └── ...
└── ...
```

## Работа с базой данных (для разработчиков плагинов)

Сервер `niNE` включает `DatabaseManager`, который обеспечивает простое сохранение и загрузку данных игроков.

### Автоматическое управление Redis

- При запуске сервер `niNE` пытается подключиться к Redis.
- Если подключение не удалось, он автоматически запускает собственный, управляемый процесс `redis-server`. Для этого `redis-server` должен быть установлен в вашей системе и доступен в `PATH`.
- Этот управляемый процесс автоматически останавливается при выключении сервера `niNE`.
- Данные и логи этого процесса сохраняются в папках `redis_data/` и `redis.log` в корне проекта.

### API для плагинов

Плагины могут получить доступ к менеджеру базы данных через объект `server`, который передается в некоторые обработчики событий, или запросив его у ядра. `DatabaseManager` предоставляет следующие методы:

- `db.set_player_attribute(player_name, attribute, value)`: Устанавливает атрибут для игрока. `value` будет автоматически преобразовано в JSON.
  ```python
  # Установить HP игрока 'John' на 100
  db.set_player_attribute('John', 'hp', 100)
  ```

- `db.get_player_attribute(player_name, attribute)`: Получает значение атрибута. Возвращает строку (которую нужно десериализовать из JSON, если это сложный тип) или `None`.
  ```python
  # Получить HP игрока 'John'
  hp_json = db.get_player_attribute('John', 'hp')
  hp = json.loads(hp_json) if hp_json else 100
  ```

- `db.get_player_all_attributes(player_name)`: Получает все атрибуты игрока в виде словаря.
  ```python
  # Получить все данные 'John'
  all_data = db.get_player_all_attributes('John')
  # all_data будет {'pos': '[1, 2, 3]', 'hp': '100'}
  ```

- `db.save_player_inventory(player_name, inventory_list)`: Сохраняет инвентарь (список).
  ```python
  inventory = ['sword', 'shield', 'potion']
  db.save_player_inventory('John', inventory)
  ```

- `db.get_player_inventory(player_name)`: Загружает инвентарь.
  ```python
  inventory = db.get_player_inventory('John')
  # inventory будет ['sword', 'shield', 'potion']
  ```

## Лицензия

Этот проект лицензирован под MIT License - подробности см. в файле [LICENSE](LICENSE).
